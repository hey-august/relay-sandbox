import { createStore, compose, applyMiddleware, combineReducers } from 'redux';
import { composeWithDevTools } from './devtoolsExtension';
import isPlainObject from './isPlainObject';
import { curryGetDefaultMiddleware, } from './getDefaultMiddleware';
const IS_PRODUCTION = process.env.NODE_ENV === 'production';
/**
 * A friendly abstraction over the standard Redux `createStore()` function.
 *
 * @param config The store configuration.
 * @returns A configured Redux store.
 *
 * @public
 */
export function configureStore(options) {
    const curriedGetDefaultMiddleware = curryGetDefaultMiddleware();
    const { reducer = undefined, middleware = curriedGetDefaultMiddleware(), devTools = true, preloadedState = undefined, enhancers = undefined, } = options || {};
    let rootReducer;
    if (typeof reducer === 'function') {
        rootReducer = reducer;
    }
    else if (isPlainObject(reducer)) {
        rootReducer = combineReducers(reducer);
    }
    else {
        throw new Error('"reducer" is a required argument, and must be a function or an object of functions that can be passed to combineReducers');
    }
    let finalMiddleware = middleware;
    if (typeof finalMiddleware === 'function') {
        finalMiddleware = finalMiddleware(curriedGetDefaultMiddleware);
        if (!IS_PRODUCTION && !Array.isArray(finalMiddleware)) {
            throw new Error('when using a middleware builder function, an array of middleware must be returned');
        }
    }
    if (!IS_PRODUCTION &&
        finalMiddleware.some((item) => typeof item !== 'function')) {
        throw new Error('each middleware provided to configureStore must be a function');
    }
    const middlewareEnhancer = applyMiddleware(...finalMiddleware);
    let finalCompose = compose;
    if (devTools) {
        finalCompose = composeWithDevTools(Object.assign({ 
            // Enable capture of stack traces for dispatched Redux actions
            trace: !IS_PRODUCTION }, (typeof devTools === 'object' && devTools)));
    }
    let storeEnhancers = [middlewareEnhancer];
    if (Array.isArray(enhancers)) {
        storeEnhancers = [middlewareEnhancer, ...enhancers];
    }
    else if (typeof enhancers === 'function') {
        storeEnhancers = enhancers(storeEnhancers);
    }
    const composedEnhancer = finalCompose(...storeEnhancers);
    return createStore(rootReducer, preloadedState, composedEnhancer);
}
//# sourceMappingURL=configureStore.js.map