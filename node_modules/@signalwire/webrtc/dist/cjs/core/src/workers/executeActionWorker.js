"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.executeActionWorker = void 0;
const effects_1 = require("@redux-saga/core/effects");
const logger_1 = require("../utils/logger");
const RPCExecute_1 = require("../RPCMessages/RPCExecute");
/**
 * Send a JSONRPC over the wire using session.execute and resolve/reject the promise
 */
const executeActionWorker = function* (options) {
    const { initialState, onDone, onFail, getSession } = options;
    const { requestId, method, params } = initialState;
    const session = getSession();
    if (!session) {
        const error = new Error('Session does not exist!');
        (0, logger_1.getLogger)().error(error);
        onFail === null || onFail === void 0 ? void 0 : onFail(error);
        return;
    }
    try {
        const message = (0, RPCExecute_1.RPCExecute)({
            id: requestId,
            method,
            params,
        });
        const response = yield (0, effects_1.call)(session.execute, message);
        onDone === null || onDone === void 0 ? void 0 : onDone(response);
    }
    catch (error) {
        (0, logger_1.getLogger)().warn('Execute error: ', error);
        onFail === null || onFail === void 0 ? void 0 : onFail(error);
    }
};
exports.executeActionWorker = executeActionWorker;
//# sourceMappingURL=executeActionWorker.js.map