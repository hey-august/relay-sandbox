"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getMemberState = exports.setMemberState = exports.getMembers = exports.getMessages = exports.publish = void 0;
const tslib_1 = require("tslib");
const utils_1 = require("../utils");
const utils_2 = require("./utils");
/**
 * Transform for returning `undefined` for `execute`s that were
 * successully resolved. If the `execute` failed for some reason, then
 * the promise will be rejected and this transform will never be
 * executed.
 */
const baseCodeTransform = () => { };
const createChatMethod = (method, options = {}) => ({
    value: function (params = {}) {
        return this.execute({
            method,
            params,
        }, options);
    },
});
const createChatMemberMethod = (method, options = {}) => ({
    value: function (_a = {}) {
        var { memberId } = _a, rest = tslib_1.__rest(_a, ["memberId"]);
        return this.execute({
            method,
            params: Object.assign({ member_id: memberId }, rest),
        }, options);
    },
});
/**
 * Chat Methods
 */
exports.publish = createChatMethod('chat.publish', {
    transformResolve: baseCodeTransform,
});
exports.getMessages = createChatMethod('chat.messages.get', {
    transformResolve: (payload) => ({
        messages: payload.messages.map((message) => (0, utils_1.toExternalJSON)(message)),
        cursor: payload.cursor,
    }),
});
exports.getMembers = createChatMethod('chat.members.get', {
    transformResolve: (payload) => ({
        members: payload.members.map((member) => (0, utils_1.toExternalJSON)(member)),
    }),
});
const transformParamChannels = (params) => {
    const channels = (0, utils_2.isValidChannels)(params === null || params === void 0 ? void 0 : params.channels)
        ? (0, utils_2.toInternalChatChannels)(params.channels)
        : undefined;
    return Object.assign(Object.assign({}, params), { channels });
};
/**
 * Chat Member Methods
 */
exports.setMemberState = createChatMemberMethod('chat.member.set_state', {
    transformResolve: baseCodeTransform,
    transformParams: transformParamChannels,
});
exports.getMemberState = createChatMemberMethod('chat.member.get_state', {
    transformResolve: (payload) => ({ channels: payload.channels }),
    transformParams: transformParamChannels,
});
//# sourceMappingURL=methods.js.map