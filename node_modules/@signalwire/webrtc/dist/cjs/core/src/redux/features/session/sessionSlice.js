"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sessionReducer = exports.sessionActions = exports.initialSessionState = void 0;
const createDestroyableSlice_1 = require("../../utils/createDestroyableSlice");
const actions_1 = require("../../actions");
exports.initialSessionState = {
    protocol: '',
    iceServers: [],
    authStatus: 'unknown',
    authState: undefined,
    authError: undefined,
    authCount: 0,
};
function authorizingAction(action) {
    return [actions_1.initAction.type, actions_1.reauthAction.type].includes(action.type);
}
const sessionSlice = (0, createDestroyableSlice_1.createDestroyableSlice)({
    name: 'session',
    initialState: exports.initialSessionState,
    reducers: {
        connected: (state, { payload }) => {
            var _a, _b;
            return Object.assign(Object.assign({}, state), { authStatus: 'authorized', authState: payload === null || payload === void 0 ? void 0 : payload.authorization, authCount: state.authCount + 1, protocol: (_a = payload === null || payload === void 0 ? void 0 : payload.protocol) !== null && _a !== void 0 ? _a : '', iceServers: (_b = payload === null || payload === void 0 ? void 0 : payload.ice_servers) !== null && _b !== void 0 ? _b : [] });
        },
        authStatus: (state, { payload }) => {
            return Object.assign(Object.assign({}, state), { authStatus: payload });
        },
        updateAuthState: (state, { payload }) => {
            return Object.assign(Object.assign({}, state), { authState: payload });
        },
    },
    extraReducers: (builder) => {
        builder.addCase(actions_1.authErrorAction.type, (state, { payload }) => {
            return Object.assign(Object.assign({}, state), { authStatus: 'unauthorized', authError: payload.error });
        });
        builder.addMatcher(authorizingAction, (state) => {
            return Object.assign(Object.assign({}, state), { authStatus: 'authorizing' });
        });
    },
});
// prettier-ignore
exports.sessionActions = sessionSlice.actions, exports.sessionReducer = sessionSlice.reducer;
//# sourceMappingURL=sessionSlice.js.map